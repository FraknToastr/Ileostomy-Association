<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ileostomy Association Calendar ‚Äî v9.2</title>
<style>
  :root { --accent1:#667eea; --accent2:#764ba2; }
  *{margin:0;padding:0;box-sizing:border-box;}
  body{
    font-family:"Segoe UI",Tahoma,Geneva,Verdana,sans-serif;
    background:linear-gradient(135deg,var(--accent1) 0%,var(--accent2) 100%);
    min-height:100vh;padding:6px;
  }
  .container{max-width:1200px;margin:0 auto;background:#fff;border-radius:12px;
    box-shadow:0 10px 30px rgba(0,0,0,.25);overflow:hidden;}
  .header{background:linear-gradient(135deg,var(--accent1) 0%,var(--accent2) 100%);
    color:#fff;padding:14px;text-align:center;}
  .header h1{font-size:1.6em;margin-bottom:4px;}
  .main-content{display:flex;flex-wrap:wrap;}
  .sidebar{width:260px;background:#f8f9fa;padding:14px;border-right:1px solid #e0e0e0;}
  .sidebar h2{color:var(--accent1);font-size:1.15em;margin-bottom:10px;}
  .filter-group{display:flex;flex-direction:column;gap:6px;}
  .filter-row{display:flex;align-items:center;gap:6px;}
  .filter-btn,.today-btn{border-radius:8px;border:none;font-size:.9em;transition:.3s;}
  .today-btn{width:100%;padding:11px;background:linear-gradient(135deg,var(--accent1),var(--accent2));
    color:#fff;font-weight:bold;margin-bottom:14px;}
  .today-btn:hover{transform:translateY(-2px);box-shadow:0 3px 10px rgba(102,126,234,.4);}
  .filter-btn{flex:1;display:flex;align-items:center;justify-content:flex-start;
    padding:8px 11px;border:1px solid #ddd;background:#fff;cursor:pointer;}
  .filter-btn:hover{transform:translateX(4px);box-shadow:0 3px 8px rgba(0,0,0,.1);}
  .filter-btn.active{background:var(--accent1);color:#fff;border-color:var(--accent1);}
  .color-indicator{width:15px;height:15px;margin-right:6px;border-radius:3px;border:1px solid rgba(0,0,0,.1);}
  .next-btn{padding:6px 10px;border:none;border-radius:6px;
    background:linear-gradient(135deg,var(--accent1),var(--accent2));
    color:#fff;font-size:.8em;cursor:pointer;white-space:nowrap;}
  .next-btn:hover{opacity:.9;transform:translateY(-1px);}
  .calendar-section{flex:1;padding:10px;}
  .calendar-nav{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;}
  .calendar-nav button{background:var(--accent1);color:white;border:none;padding:7px 13px;
    border-radius:6px;font-size:.9em;cursor:pointer;transition:.3s;}
  .calendar-nav button:hover{background:var(--accent2);}
  .calendar-nav h2{color:#333;font-size:1.3em;}
  .calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:3px;}
  .day-header{text-align:center;font-weight:700;color:var(--accent1);
    background:#f8f9fa;border-radius:6px;font-size:1.6em;padding:10px 4px;}
  .day{border:1px solid #e0e0e0;border-radius:6px;padding:4px 5px;
    display:flex;flex-direction:column;justify-content:space-between;transition:.25s;
    background:#fff;min-height:70px;} /* +25% height retained */
  .day:hover{transform:scale(1.03);box-shadow:0 4px 8px rgba(0,0,0,.15);}
  .day.other-month{opacity:.3;}
  .day-number{font-size:.9em;font-weight:bold;}
  .day-events{font-size:.8em;font-weight:600;margin-top:auto;line-height:1.3em;
    display:flex;align-items:center;gap:4px;flex-wrap:wrap;}
  .day-events .emoji{font-size:1.5em;line-height:1em;}

  /* Baseline / closed */
  .day.open-day,.day.clinic-day{background:linear-gradient(135deg,#84fab0 0%,#8fd3f4 100%);}
  .day.admin-day{background:linear-gradient(135deg,#ffecd2 0%,#fcb69f 100%);}   /* Thu: Closed (Admin Day) */
  .day.closed-day{background:linear-gradient(135deg,#ffecd2 0%,#fcb69f 100%);}  /* Sun + 1st/2nd/4th/5th Sat */

  /* Special / Major events */
  .day.closure-day{background:linear-gradient(135deg,#ff6b6b 0%,#c92a2a 100%);color:white;} /* Christmas/NY */
  .day.easter-day{background:linear-gradient(135deg,#7b4397 0%,#4a148c 100%);color:white;}    /* Easter */
  .day.publicholiday-day{background:linear-gradient(135deg,#43cea2 0%,#185a9d 100%);color:white;} /* üèñÔ∏è PH */
  .day.bbq-day{background:linear-gradient(135deg,#ffd93d 0%,#ff6b35 100%);}                    /* BBQ */
  .day.agm-day{background:linear-gradient(135deg,#99f2c8 0%,#f9f586 50%,#f6d365 100%);color:#222;text-shadow:0 0 6px rgba(255,255,255,0.6);} /* AGM */
  .day.education-day{background:linear-gradient(135deg,#b2fefa 0%,#0ed2f7 100%);}             /* Education */
  .day.committee-day{background:linear-gradient(135deg,#ff4fd8 0%,#ff0080 100%);color:white;} /* Committee */

  .day.today{border:3px solid var(--accent1);box-shadow:0 0 6px rgba(102,126,234,0.6);}
  .day.hidden{opacity:.15;pointer-events:none;}

  /* AGM underline polish (retained) */
  .agm-label{position:relative;display:inline-block;}
  .agm-label::after{content:"";position:absolute;left:0;bottom:-2px;width:100%;height:2px;
    background:linear-gradient(90deg,#fff176,#f57c00);animation:agm-underline 2s infinite alternate;}
  @keyframes agm-underline{from{transform:scaleX(0);opacity:.3;}to{transform:scaleX(1);opacity:1;}}

  @media(max-width:600px){
    .day-header{font-size:1em;padding:6px 2px;}
    .day-number{font-size:.7em;}
    .day-events{font-size:.6em;}
    .day-events .emoji{font-size:1em;}
    .calendar-nav h2{font-size:1em;}
    .today-btn,.filter-btn{font-size:.8em;padding:6px;}
  }
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>üè• Ileostomy Association Calendar</h1>
    <p>Supporting our community with care and compassion</p>
  </div>
  <div class="main-content">
    <div class="sidebar">
      <h2>Filter Events</h2>
      <button class="today-btn" id="todayBtn">üìÖ Back to Today</button>

      <div class="filter-group">
        <!-- Per-month toggles -->
        <button class="filter-btn" data-filter="open">
          <span class="color-indicator" style="background:linear-gradient(135deg,#84fab0,#8fd3f4)"></span>üè† Open
        </button>
        <button class="filter-btn" data-filter="clinic">
          <span class="color-indicator" style="background:linear-gradient(135deg,#84fab0,#8fd3f4)"></span>üë©‚Äç‚öïÔ∏è Open/Clinic
        </button>

        <!-- BBQ + Next -->
        <div class="filter-row">
          <button class="filter-btn" data-filter="bbq">
            <span class="color-indicator" style="background:linear-gradient(135deg,#ffd93d,#ff6b35)"></span>üçî Paul Martin BBQ
          </button>
          <button class="next-btn" id="nextBBQ">Next ‚Üí</button>
        </div>

        <!-- Committee + Next -->
        <div class="filter-row">
          <button class="filter-btn" data-filter="committee">
            <span class="color-indicator" style="background:linear-gradient(135deg,#ff4fd8,#ff0080)"></span>üßë‚Äçüíº Committee
          </button>
          <button class="next-btn" id="nextCommittee">Next ‚Üí</button>
        </div>

        <!-- Public Holidays + Next -->
        <div class="filter-row">
          <button class="filter-btn" data-filter="publicholiday">
            <span class="color-indicator" style="background:linear-gradient(135deg,#43cea2,#185a9d)"></span>üèñÔ∏è Public Holidays
          </button>
          <button class="next-btn" id="nextPublicHoliday">Next ‚Üí</button>
        </div>

        <!-- Education Days + Next -->
        <div class="filter-row">
          <button class="filter-btn" data-filter="education">
            <span class="color-indicator" style="background:linear-gradient(135deg,#b2fefa,#0ed2f7)"></span>üéì Education Days
          </button>
          <button class="next-btn" id="nextEducation">Next ‚Üí</button>
        </div>

        <!-- Remaining per-month toggles -->
        <button class="filter-btn" data-filter="agm">
          <span class="color-indicator" style="background:linear-gradient(135deg,#99f2c8,#f6d365)"></span>üßæ AGM
        </button>
        <button class="filter-btn" data-filter="easter">
          <span class="color-indicator" style="background:linear-gradient(135deg,#7b4397,#4a148c)"></span>üê£ Easter
        </button>
        <button class="filter-btn" data-filter="closure">
          <span class="color-indicator" style="background:linear-gradient(135deg,#ff6b6b,#c92a2a)"></span>üéÖ Holiday Closure
        </button>
      </div>
    </div>

    <div class="calendar-section">
      <div class="calendar-nav">
        <button id="prevMonth">‚Üê Prev</button>
        <h2 id="monthYear"></h2>
        <button id="nextMonth">Next ‚Üí</button>
      </div>
      <div class="calendar" id="calendar"></div>
    </div>
  </div>
</div>

<script>
/* ========= State ========= */
let currentDate = new Date();
const filters = {
  open:false, clinic:false, bbq:false, committee:false, education:false,
  agm:false, publicholiday:false, easter:false, closure:false
};

/* ========= Emojis ========= */
const emojiMap = {
  open:"üè†", clinic:"üë©‚Äç‚öïÔ∏è", bbq:"üçî", committee:"üßë‚Äçüíº", education:"üéì",
  agm:"üßæ", publicholiday:"üèñÔ∏è", easter:"üê£", admin:"üò¥", closed:"üò¥", closure:"üéÖ"
};

/* ========= Event Data ========= */
// BBQ ‚Äî fixed 2026 dates
const BBQ_DATES = [
  new Date(2026,1,15),  // 15 Feb 2026
  new Date(2026,5,14),  // 14 Jun 2026
  new Date(2026,10,15), // 15 Nov 2026
];

// AGM ‚Äî single date 2025
const AGM_DATE = new Date(2025,9,18); // 18 Oct 2025

// Committee ‚Äî 3rd Monday monthly (all years)
function isCommitteeDay(d){
  return d.getDay()===1 && Math.ceil(d.getDate()/7)===3;
}

// Clinic ‚Äî every Wednesday and the 3rd Saturday
function isClinicDay(d){
  const dow = d.getDay();
  if (dow===3) return true; // Wed
  if (dow!==6) return false; // Sat only
  return Math.ceil(d.getDate()/7)===3; // 3rd Saturday
}

// Public Holidays ‚Äî 2026 only
const PUBLIC_HOLIDAYS_2026 = new Set([
  "2026-01-26","2026-03-09","2026-06-08","2026-10-05"
]);

// Education Days ‚Äî 2026 only (with locations)
const EDUCATION_2026 = {
  "2026-05-21":"Murray Bridge",
  "2026-06-18":"Clare",
  "2026-07-23":"Metro",
  "2026-08-20":"Morphett Vale",
  "2026-09-17":"Mt Gambier",
  "2026-10-15":"Kadina",
  "2026-10-29":"Barossa",
  "2026-11-19":"Whyalla"
};

// Christmas/NY closure ‚Äî every year, Dec 25 ‚Üí Jan 2 inclusive
function isChristmasClosure(d){
  const m=d.getMonth(), day=d.getDate();
  return (m===11 && day>=25) || (m===0 && day<=2);
}

/* ========= Easter (Good Fri ‚Üí Easter Mon) ========= */
function computus(year){
  const a=year%19,b=Math.floor(year/100),c=year%100,d=Math.floor(b/4),e=b%4;
  const f=Math.floor((b+8)/25),g=Math.floor((b-f+1)/3);
  const h=(19*a+b-d-g+15)%30,i=Math.floor(c/4),k=c%4,l=(32+2*e+2*i-h-k)%7;
  const m=Math.floor((a+11*h+22*l)/451);
  const month=Math.floor((h+l-7*m+114)/31)-1;
  const day=((h+l-7*m+114)%31)+1;
  return new Date(year,month,day);
}
const EASTER_BLOCKS=[];
for(let y=2025;y<=2029;y++){
  const sun=computus(y);
  const goodFri=new Date(sun); goodFri.setDate(sun.getDate()-2);
  const easterMon=new Date(sun); easterMon.setDate(sun.getDate()+1);
  EASTER_BLOCKS.push({start:goodFri,end:easterMon});
}
function isWithin(date,start,end){
  const s=new Date(start.getFullYear(),start.getMonth(),start.getDate());
  const e=new Date(end.getFullYear(),end.getMonth(),end.getDate());
  const d=new Date(date.getFullYear(),date.getMonth(),date.getDate());
  return d>=s && d<=e;
}
function isEaster(date){ return EASTER_BLOCKS.some(({start,end})=>isWithin(date,start,end)); }

/* ========= Baseline Schedule ========= */
// Open = Mon/Tue/Wed/Fri + 3rd Saturday (clinic Saturday is open)
function isOpenDay(d){
  const dow=d.getDay();
  if ([1,2,3,5].includes(dow)) return true; // Mon/Tue/Wed/Fri
  if (dow===6 && Math.ceil(d.getDate()/7)===3) return true; // 3rd Saturday
  return false;
}
// Admin Day = Thursdays only
function isAdminDay(d){ return d.getDay()===4; }
// Closed (non-admin) = Sundays and all Saturdays except 3rd
function isClosedNonAdmin(d){
  const dow=d.getDay();
  if (dow===0) return true; // Sunday
  if (dow!==6) return false; // Only Saturdays
  const week=Math.ceil(d.getDate()/7);
  return week!==3; // 1st/2nd/4th/5th Saturdays are closed
}

/* ========= Helpers ========= */
function pad(n){return n.toString().padStart(2,"0");}
function keyFor(d){return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;}
function dateEquals(a,b){return a.toDateString()===b.toDateString();}
function inBBQ(d){return BBQ_DATES.some(dt=>dateEquals(dt,d));}
function isPublicHoliday(d){return PUBLIC_HOLIDAYS_2026.has(keyFor(d));}
function isEducationDay(d){return Boolean(EDUCATION_2026[keyFor(d)]);}

/* ========= Event Types per Day =========
   Exclusives (closure/easter/publicholiday) first, then majors, then baseline */
function getEventTypes(date){
  const types=[];
  // Special exclusive overrides
  if (isChristmasClosure(date)) { types.push("closure"); return types; }
  if (isEaster(date)) { types.push("easter"); return types; }
  if (isPublicHoliday(date)) { types.push("publicholiday"); return types; }

  // Majors (won't coincide with public holidays per brief)
  if (dateEquals(date,AGM_DATE)) types.push("agm");
  if (inBBQ(date)) types.push("bbq");
  if (isEducationDay(date)) types.push("education");
  if (isCommitteeDay(date)) types.push("committee");

  // Baseline flags
  if (isAdminDay(date)) types.push("admin");                 // Thu
  if (isClosedNonAdmin(date)) types.push("closed");          // Sun + non-3rd Sat
  if (isOpenDay(date)) types.push("open");                   // Mon/Tue/Wed/Fri + 3rd Sat
  if (isClinicDay(date)) types.push("clinic");               // Wed + 3rd Sat

  // Ensure closed Saturdays never go uncoloured/labelled
  if (!types.includes("admin") && isClosedNonAdmin(date) && !types.includes("closed")) {
    types.push("closed");
  }
  return [...new Set(types)];
}

/* ========= Colour precedence (background class) =========
   closure > easter > publicholiday > agm > bbq > education > committee > admin > closed > clinic > open */
function pickClass(types){
  if (types.includes("closure")) return "closure-day";
  if (types.includes("easter")) return "easter-day";
  if (types.includes("publicholiday")) return "publicholiday-day";
  if (types.includes("agm")) return "agm-day";
  if (types.includes("bbq")) return "bbq-day";
  if (types.includes("education")) return "education-day";
  if (types.includes("committee")) return "committee-day";
  if (types.includes("admin")) return "admin-day";
  if (types.includes("closed")) return "closed-day";
  if (types.includes("clinic")) return "clinic-day";
  if (types.includes("open")) return "open-day";
  return "";
}

/* ========= Labels =========
   - closure/easter/publicholiday: single-label or emoji-only rule below
   - education: "Education: <Place>"
   - committee: "Committee"
   - agm: "AGM"
   - admin: "Closed (Admin Day)"
   - closed: "Closed"
   - clinic/open appended when not overridden by special/publicholiday */
function getEventLabel(types,date){
  const key=keyFor(date);

  // Special days show emoji-only (no text)
  if (types.includes("closure") || types.includes("easter")) return "";

  // Public Holiday: single label
  if (types.includes("publicholiday")) return "Public Holiday";

  const parts=[];
  if (types.includes("bbq")) parts.push("BBQ");
  if (types.includes("agm")) parts.push("AGM");
  if (types.includes("education")) parts.push(`Education: ${EDUCATION_2026[key]}`);
  if (types.includes("committee")) parts.push("Committee");
  if (types.includes("clinic")) parts.push("Open/Clinic");
  else if (types.includes("open")) parts.push("Open");
  if (types.includes("admin")) parts.push("Closed (Admin Day)");
  if (types.includes("closed")) parts.push("Closed");

  const seen=new Set();
  return parts.filter(p=>!seen.has(p) && seen.add(p)).join("/");
}

/* ========= Emoji rendering =========
   - closure/easter/publicholiday: exclusive single emoji
   - otherwise, show all relevant distinct emojis (includes üò¥ for admin/closed) */
function buildEmojiHTML(types){
  if (types.includes("closure")) return `<span class="emoji">${emojiMap["closure"]}</span>`;
  if (types.includes("easter"))  return `<span class="emoji">${emojiMap["easter"]}</span>`;
  if (types.includes("publicholiday")) return `<span class="emoji">${emojiMap["publicholiday"]}</span>`;

  const list=[];
  const already=new Set();
  const order = ["bbq","agm","education","committee","clinic","open","admin","closed"]; // stable, readable order
  for (const t of order){
    if (types.includes(t)){
      const em = emojiMap[t];
      if (em && !already.has(em)){
        list.push(`<span class="emoji">${em}</span>`);
        already.add(em);
      }
    }
  }
  return list.join(" ");
}

/* ========= Rendering ========= */
const dayHeaders=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];

function renderCalendar(){
  const y=currentDate.getFullYear(), m=currentDate.getMonth();
  document.getElementById("monthYear").textContent=currentDate.toLocaleDateString("en-US",{month:"long",year:"numeric"});

  const firstDay=new Date(y,m,1).getDay();
  const daysInMonth=new Date(y,m+1,0).getDate();
  const prevDays=new Date(y,m,0).getDate();
  const cal=document.getElementById("calendar"); cal.innerHTML="";

  // headers
  dayHeaders.forEach(d=>{
    const h=document.createElement("div");
    h.className="day-header";
    h.textContent=d;
    cal.appendChild(h);
  });

  const anyFilterActive = Object.values(filters).some(v=>v);

  function makeDay(date,offset=0){
    const types=getEventTypes(date);
    const cls=["day"];
    const colourClass=pickClass(types);
    if (colourClass) cls.push(colourClass);
    if (offset!==0) cls.push("other-month");
    if (date.toDateString()===new Date().toDateString()) cls.push("today");

    // Filter visibility applies only for the displayed month
    let visible=true;
    if (anyFilterActive && offset===0){
      const matches = Object.entries(filters).some(([t,on])=>on && types.includes(t));
      if (!matches) visible=false;
    }
    if (!visible) cls.push("hidden");

    const label=getEventLabel(types,date);
    const emojiHTML=buildEmojiHTML(types);

    const d=document.createElement("div");
    d.className=cls.join(" ");
    d.innerHTML =
      `<div class="day-number">${date.getDate()}</div>` +
      ((emojiHTML || label) ? `<div class="day-events">${emojiHTML}${label?` ${label}`:""}</div>` : "");
    return d;
  }

  // prev spill
  for(let i=firstDay-1;i>=0;i--) cal.appendChild(makeDay(new Date(y,m-1,prevDays-i),-1));
  // current month
  for(let i=1;i<=daysInMonth;i++) cal.appendChild(makeDay(new Date(y,m,i),0));
  // next spill to fill 6 rows (7 headers + 42 cells total)
  const total=cal.children.length-7;
  for(let i=1;i<=42-total-7;i++) cal.appendChild(makeDay(new Date(y,m+1,i),1));
}

/* ========= Smart Next (12 months) ========= */
function findNextDate(predicate,maxMonths=12){
  for(let off=1; off<=maxMonths; off++){
    const test=new Date(currentDate);
    test.setMonth(currentDate.getMonth()+off);
    const days=new Date(test.getFullYear(),test.getMonth()+1,0).getDate();
    for(let d=1; d<=days; d++){
      const dt=new Date(test.getFullYear(),test.getMonth(),d);
      if (predicate(dt)) return test;
    }
  }
  return null;
}

/* ========= Controls ========= */
document.getElementById("prevMonth").onclick=()=>{ currentDate.setMonth(currentDate.getMonth()-1); renderCalendar(); };
document.getElementById("nextMonth").onclick=()=>{ currentDate.setMonth(currentDate.getMonth()+1); renderCalendar(); };

document.getElementById("todayBtn").onclick=()=>{
  currentDate=new Date();
  for(const f in filters) filters[f]=false;
  document.querySelectorAll(".filter-btn").forEach(b=>b.classList.remove("active"));
  renderCalendar();
};

// Per-month filter toggles (no month jump)
document.querySelectorAll(".filter-btn").forEach(btn=>{
  const f=btn.dataset.filter;
  if(!f) return; // skip Next buttons
  btn.addEventListener("click",()=>{
    filters[f]=!filters[f];
    btn.classList.toggle("active");
    renderCalendar();
  });
});

// ‚ÄúNext ‚Üí‚Äù buttons (12-month scan)
document.getElementById("nextBBQ").onclick=()=>{
  const m=findNextDate(d=>inBBQ(d),12); if(m){ currentDate=m; renderCalendar(); }
};
document.getElementById("nextCommittee").onclick=()=>{
  const m=findNextDate(d=>isCommitteeDay(d),12); if(m){ currentDate=m; renderCalendar(); }
};
document.getElementById("nextPublicHoliday").onclick=()=>{
  const m=findNextDate(d=>isPublicHoliday(d),12); if(m){ currentDate=m; renderCalendar(); }
};
document.getElementById("nextEducation").onclick=()=>{
  const m=findNextDate(d=>isEducationDay(d),12); if(m){ currentDate=m; renderCalendar(); }
};

renderCalendar();
</script>
</body>
</html>
