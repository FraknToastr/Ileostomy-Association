<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ileostomy Association Calendar — v9.7d (Mobile Fork + Toggle Filters + Labels)</title>

<style>
  :root { --accent1:#667eea; --accent2:#764ba2; }
  *{margin:0;padding:0;box-sizing:border-box;}
  body{
    font-family:"Segoe UI",Tahoma,Geneva,Verdana,sans-serif;
    background:linear-gradient(135deg,var(--accent1) 0%,var(--accent2) 100%);
    min-height:100vh;padding:6px;
  }
  .container{max-width:1200px;margin:0 auto;background:#fff;border-radius:12px;
    box-shadow:0 10px 30px rgba(0,0,0,.25);overflow:hidden;}
  .header{background:linear-gradient(135deg,var(--accent1) 0%,var(--accent2) 100%);
    color:#fff;padding:14px;text-align:center;}
  .header h1{font-size:1.6em;margin-bottom:4px;}
  .main-content{display:flex;flex-wrap:wrap;}

  /* Desktop sidebar */
  .sidebar{
    width:320px;background:#f8f9fa;padding:14px;border-right:1px solid #e0e0e0;
  }

  /* Control row: Back to today + Hide/Show Filters */
  .top-controls{
    display:flex;gap:8px;align-items:center;margin-bottom:12px;
  }
  .today-btn{
    flex:1;border-radius:8px;border:none;font-size:.9em;
    padding:11px;background:linear-gradient(135deg,var(--accent1),var(--accent2));
    color:#fff;font-weight:bold;cursor:pointer;transition:.3s;
  }
  .today-btn:hover{transform:translateY(-2px);box-shadow:0 3px 10px rgba(102,126,234,.4);}
  .today-btn.half-btn{flex:1;width:50%;}

  .filter-group{display:flex;flex-direction:column;gap:6px;}
  .filter-row{display:flex;align-items:center;gap:6px;}

  .filter-btn{
    flex:1;display:flex;align-items:center;justify-content:flex-start;
    padding:8px 11px;border-radius:8px;
    border:1px solid #ddd;background:#fff;cursor:pointer;
    font-size:.9em;transition:.3s;white-space:nowrap;
  }
  .filter-btn:hover{transform:translateX(4px);box-shadow:0 3px 8px rgba(0,0,0,.1);}
  .filter-btn.active{background:var(--accent1);color:#fff;border-color:var(--accent1);}

  /* allow wrapping for the Christmas/New Years filter label only */
  .filter-btn.allow-wrap{white-space:normal; line-height:1.15em;}

  .color-indicator{width:15px;height:15px;margin-right:6px;border-radius:3px;border:1px solid rgba(0,0,0,.1);}

  .nav-btn{
    width:34px;height:34px;
    display:flex;align-items:center;justify-content:center;
    padding:0;border:none;border-radius:6px;
    background:linear-gradient(135deg,var(--accent1),var(--accent2));
    color:#fff;font-size:1.1em;cursor:pointer;white-space:nowrap;transition:.2s;
  }
  .nav-btn:hover{opacity:.9;transform:translateY(-1px);}

  .calendar-section{flex:1;padding:10px;}
  .calendar-nav{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;}
  .calendar-nav button{background:var(--accent1);color:white;border:none;padding:7px 13px;
    border-radius:6px;font-size:.9em;cursor:pointer;transition:.3s;}
  .calendar-nav button:hover{background:var(--accent2);}
  .calendar-nav h2{color:#333;font-size:1.3em;}

  .calendar{
    display:grid;
    grid-template-columns:repeat(7, minmax(0, 1fr)); /* even distribution + prevent overflow */
    gap:3px;
    width:100%;
  }
  .day-header{text-align:center;font-weight:700;color:var(--accent1);
    background:#f8f9fa;border-radius:6px;font-size:1.6em;padding:10px 4px;}
  .day{border:1px solid #e0e0e0;border-radius:6px;padding:4px 5px;
    display:flex;flex-direction:column;justify-content:space-between;transition:.25s;
    background:#fff;min-height:70px;} /* desktop baseline */
  .day:hover{transform:scale(1.03);box-shadow:0 4px 8px rgba(0,0,0,.15);}
  .day.other-month{opacity:.3;}
  .day-number{font-size:.9em;font-weight:bold;}
  .day-events{
    font-size:.8em;font-weight:600;margin-top:auto;line-height:1.3em;
    display:flex;flex-direction:column;align-items:flex-start;gap:4px;
    max-width:100%;
  }
  .day-events > div{
    max-width:100%;
    white-space:normal;
    word-break:break-word;
    overflow:hidden;
  }

  /* Baseline / closed */
  .day.open-day,.day.clinic-day{background:linear-gradient(135deg,#84fab0 0%,#8fd3f4 100%);}
  .day.admin-day{background:linear-gradient(135deg,#ffecd2 0%,#fcb69f 100%);}
  .day.closed-day{background:linear-gradient(135deg,#ffecd2 0%,#fcb69f 100%);}

  /* Special / Major events */
  .day.closure-day{background:linear-gradient(135deg,#ff6b6b 0%,#c92a2a 100%);color:white;}
  .day.easter-day{background:linear-gradient(135deg,#7b4397 0%,#4a148c 100%);color:white;}
  .day.publicholiday-day{background:linear-gradient(135deg,#43cea2 0%,#185a9d 100%);color:white;}
  .day.bbq-day{background:linear-gradient(135deg,#ffd93d 0%,#ff6b35 100%);}
  .day.agm-day{background:linear-gradient(135deg,#99f2c8 0%,#f9f586 50%,#f6d365 100%);color:#222;text-shadow:0 0 6px rgba(255,255,255,0.6);}
  .day.education-day{background:linear-gradient(135deg,#b2fefa 0%,#0ed2f7 100%);}
  .day.committee-day{background:linear-gradient(135deg,#ff4fd8 0%,#ff0080 100%);color:white;}

  .day.today{border:3px solid var(--accent1);box-shadow:0 0 6px rgba(102,126,234,0.6);}
  .day.hidden{opacity:.15;pointer-events:none;}

  /* Focus highlight mode for arrow nav */
  .day.dim{opacity:.14;}
  .day.focus{outline:3px solid rgba(0,0,0,.55);outline-offset:-3px;}

  /* Filters collapsed mode */
  body.filters-collapsed .filter-group{display:none;}

  /* Single-filter mode hides all but one row/button */
  .single-hide{display:none !important;}

  /* ===== Mobile ===== */
  @media(max-width:700px){
    body{padding:4px;}

    .container{border-radius:10px;}
    .header{padding:10px;}
    .header h1{font-size:1.2em;margin-bottom:2px;}
    .header p{font-size:.86em;line-height:1.2;}

    .main-content{flex-direction:column;}

    .sidebar{
      width:100%;
      border-right:none;
      border-bottom:1px solid #e0e0e0;
      padding:10px;
    }

    .calendar-section{padding:8px;}

    .calendar-nav{margin-bottom:8px;}
    .calendar-nav h2{font-size:1em;}
    .calendar-nav button{padding:6px 10px;font-size:.8em;border-radius:6px;}

    .calendar{gap:1px;}
    .day-header{
      font-size:.92em;
      padding:5px 1px;
      border-radius:6px;
    }
    .day{
      min-height:50px;
      padding:2px 3px;
      border-radius:6px;
    }
    .day-number{font-size:.66em;}
    .day-events{
      font-size:.54em;
      line-height:1.12em;
      gap:2px;
    }

    .top-controls{gap:6px;margin-bottom:10px;}
    .today-btn{padding:10px;font-size:.8em;}

    .filter-btn{font-size:.8em;padding:7px 10px;}
    .nav-btn{width:30px;height:30px;font-size:.98em;border-radius:6px;}

    /* Disable hover grow on mobile */
    .day:hover{transform:none;box-shadow:none;}
    .filter-btn:hover{transform:none;box-shadow:none;}
    .nav-btn:hover{transform:none;}
    .today-btn:hover{transform:none;box-shadow:none;}
  }

  @media(max-width:420px){
    .header h1{font-size:1.1em;}
    .header p{font-size:.84em;}

    .calendar-nav h2{font-size:.96em;}
    .calendar-nav button{padding:6px 9px;font-size:.78em;}

    .day-header{font-size:.88em;padding:5px 1px;}
    .day{min-height:48px;padding:2px 3px;}
    .day-number{font-size:.64em;}
    .day-events{font-size:.52em;line-height:1.1em;}
  }

  @media(max-width:360px){
    .calendar{gap:1px;}
    .day{min-height:46px;padding:2px 3px;}
    .day-events{font-size:.5em;}
  }
</style>
</head>

<body>
<div class="container">
  <div class="header">
    <h1>Ileostomy Association Calendar</h1>
    <p>Supporting our community with care and compassion</p>
  </div>

  <div class="main-content">
    <div class="sidebar">
      <!-- Removed "Filter Events" title -->

      <div class="top-controls">
        <button class="today-btn half-btn" id="todayBtn">Back to Today</button>
        <button class="today-btn half-btn" id="toggleFiltersBtn" type="button">Hide Filters</button>
      </div>

      <div class="filter-group" id="filterGroup">
        <button class="filter-btn" data-filter="open" data-single="open">
          <span class="color-indicator" style="background:linear-gradient(135deg,#84fab0,#8fd3f4)"></span>Open
        </button>

        <button class="filter-btn" data-filter="clinic" data-single="clinic">
          <span class="color-indicator" style="background:linear-gradient(135deg,#84fab0,#8fd3f4)"></span>Open/Clinic
        </button>

        <div class="filter-row" data-single="bbq">
          <button class="filter-btn" data-filter="bbq" data-single="bbq">
            <span class="color-indicator" style="background:linear-gradient(135deg,#ffd93d,#ff6b35)"></span>Paul Martin BBQ
          </button>
          <button class="nav-btn" id="prevBBQ" aria-label="Previous BBQ">◀</button>
          <button class="nav-btn" id="nextBBQ" aria-label="Next BBQ">▶</button>
        </div>

        <div class="filter-row" data-single="committee">
          <button class="filter-btn" data-filter="committee" data-single="committee">
            <span class="color-indicator" style="background:linear-gradient(135deg,#ff4fd8,#ff0080)"></span>Committee
          </button>
          <button class="nav-btn" id="prevCommittee" aria-label="Previous Committee">◀</button>
          <button class="nav-btn" id="nextCommittee" aria-label="Next Committee">▶</button>
        </div>

        <div class="filter-row" data-single="publicholiday">
          <button class="filter-btn" data-filter="publicholiday" data-single="publicholiday">
            <span class="color-indicator" style="background:linear-gradient(135deg,#43cea2,#185a9d)"></span>Public Holidays
          </button>
          <button class="nav-btn" id="prevPublicHoliday" aria-label="Previous Public Holiday">◀</button>
          <button class="nav-btn" id="nextPublicHoliday" aria-label="Next Public Holiday">▶</button>
        </div>

        <div class="filter-row" data-single="education">
          <button class="filter-btn" data-filter="education" data-single="education">
            <span class="color-indicator" style="background:linear-gradient(135deg,#b2fefa,#0ed2f7)"></span>Education Days
          </button>
          <button class="nav-btn" id="prevEducation" aria-label="Previous Education Day">◀</button>
          <button class="nav-btn" id="nextEducation" aria-label="Next Education Day">▶</button>
        </div>

        <div class="filter-row" data-single="agm">
          <button class="filter-btn" data-filter="agm" data-single="agm">
            <span class="color-indicator" style="background:linear-gradient(135deg,#99f2c8,#f6d365)"></span>AGM
          </button>
          <button class="nav-btn" id="prevAGM" aria-label="Previous AGM">◀</button>
          <button class="nav-btn" id="nextAGM" aria-label="Next AGM">▶</button>
        </div>

        <div class="filter-row" data-single="easter">
          <button class="filter-btn" data-filter="easter" data-single="easter">
            <span class="color-indicator" style="background:linear-gradient(135deg,#7b4397,#4a148c)"></span>Easter
          </button>
          <button class="nav-btn" id="prevEaster" aria-label="Previous Easter">◀</button>
          <button class="nav-btn" id="nextEaster" aria-label="Next Easter">▶</button>
        </div>

        <div class="filter-row" data-single="closure">
          <button class="filter-btn allow-wrap" data-filter="closure" data-single="closure">
            <span class="color-indicator" style="background:linear-gradient(135deg,#ff6b6b,#c92a2a)"></span>
            Christmas/New<br>Years
          </button>
          <button class="nav-btn" id="prevClosure" aria-label="Previous Christmas/New Years">◀</button>
          <button class="nav-btn" id="nextClosure" aria-label="Next Christmas/New Years">▶</button>
        </div>
      </div>
    </div>

    <div class="calendar-section">
      <div class="calendar-nav">
        <button id="prevMonth">← Prev</button>
        <h2 id="monthYear"></h2>
        <button id="nextMonth">Next →</button>
      </div>
      <div class="calendar" id="calendar"></div>
    </div>
  </div>
</div>

<script>
/* ============================================================================
   State
============================================================================ */
let currentDate = new Date();

const filters = {
  open:false, clinic:false, bbq:false, committee:false, education:false,
  agm:false, publicholiday:false, easter:false, closure:false
};

/* Focus (triggered by arrow nav buttons only) */
let focusType = null;
let focusMonthKey = null;

/* Single-filter mode UI state */
let singleFilterMode = null;

/* ============================================================================
   Constants
============================================================================ */
const dayHeaders = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];

/* ============================================================================
   Event Data
============================================================================ */
const BBQ_DATES = [
  new Date(2026,1,15),
  new Date(2026,5,14),
  new Date(2026,10,15)
];

const AGM_DATE = new Date(2026,9,18); // 18 Oct 2026

const PUBLIC_HOLIDAYS_2026 = new Set(["2026-01-26","2026-03-09","2026-06-08","2026-10-05"]);

const EDUCATION_2026 = {
  "2026-05-21":"Murray Bridge",
  "2026-06-18":"Clare",
  "2026-07-23":"Metro",
  "2026-08-06":"Barossa",
  "2026-08-20":"Morphett Vale",
  "2026-09-17":"Mt Gambier",
  "2026-10-15":"Kadina",
  "2026-11-19":"Whyalla"
};

/* ============================================================================
   Schedule Rules
============================================================================ */
function isCommitteeDay(d){ return d.getDay()===1 && Math.ceil(d.getDate()/7)===3; }

function isClinicDay(d){
  const dow=d.getDay();
  if(dow===3) return true;
  if(dow!==6) return false;
  return Math.ceil(d.getDate()/7)===3;
}

function isOpenDay(d){
  const dow=d.getDay();
  if([1,2,3,5].includes(dow)) return true;
  if(dow===6 && Math.ceil(d.getDate()/7)===3) return true;
  return false;
}

function isAdminDay(d){ return d.getDay()===4; }

function isClosedNonAdmin(d){
  const dow=d.getDay();
  if(dow===0) return true;
  if(dow!==6) return false;
  return Math.ceil(d.getDate()/7)!==3;
}

/* ============================================================================
   Helpers
============================================================================ */
function pad(n){return n.toString().padStart(2,"0");}
function keyFor(d){return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;}
function monthKey(d){return `${d.getFullYear()}-${pad(d.getMonth()+1)}`;}
function dateEquals(a,b){return a.toDateString()===b.toDateString();}
function inBBQ(d){return BBQ_DATES.some(dt=>dateEquals(dt,d));}
function isPublicHoliday(d){ return PUBLIC_HOLIDAYS_2026.has(keyFor(d)); }
function isEducationDay(d){ return Boolean(EDUCATION_2026[keyFor(d)]); }

/* Christmas/New Years closure */
function isChristmasClosure(d){
  const m=d.getMonth(), day=d.getDate();
  return (m===11 && day>=25) || (m===0 && day<=2);
}

/* Easter (2025–2029) */
function computus(y){
  const a=y%19,b=Math.floor(y/100),c=y%100,d=Math.floor(b/4),e=b%4,f=Math.floor((b+8)/25),
        g=Math.floor((b-f+1)/3),h=(19*a+b-d-g+15)%30,i=Math.floor(c/4),k=c%4,l=(32+2*e+2*i-h-k)%7,
        m=Math.floor((a+11*h+22*l)/451),
        month=Math.floor((h+l-7*m+114)/31)-1,
        day=((h+l-7*m+114)%31)+1;
  return new Date(y,month,day);
}
const EASTER_BLOCKS=[];
for(let y=2025;y<=2029;y++){
  const sun=computus(y);
  const gf=new Date(sun); gf.setDate(sun.getDate()-2);
  const em=new Date(sun); em.setDate(sun.getDate()+1);
  EASTER_BLOCKS.push({start:gf,end:em});
}
function isWithin(d,s,e){
  const D=new Date(d.getFullYear(),d.getMonth(),d.getDate());
  const S=new Date(s.getFullYear(),s.getMonth(),s.getDate());
  const E=new Date(e.getFullYear(),e.getMonth(),e.getDate());
  return D>=S && D<=E;
}
function isEaster(d){ return EASTER_BLOCKS.some(({start,end})=>isWithin(d,start,end)); }

/* ============================================================================
   Event Typing
============================================================================ */
function getEventTypes(date){
  if(isChristmasClosure(date)) return ["closure"];
  if(isEaster(date))          return ["easter"];
  if(isPublicHoliday(date))   return ["publicholiday"];
  if(inBBQ(date)) return ["bbq"];

  const types=[];
  if(dateEquals(date,AGM_DATE)) types.push("agm");
  if(isEducationDay(date))      types.push("education");
  if(isCommitteeDay(date))      types.push("committee");

  if(isAdminDay(date))       types.push("admin");
  if(isClosedNonAdmin(date)) types.push("closed");
  if(isOpenDay(date))        types.push("open");
  if(isClinicDay(date))      types.push("clinic");

  return [...new Set(types)];
}

/* Colour precedence */
function pickClass(types){
  if(types.includes("closure"))       return "closure-day";
  if(types.includes("easter"))        return "easter-day";
  if(types.includes("publicholiday")) return "publicholiday-day";
  if(types.includes("agm"))           return "agm-day";
  if(types.includes("bbq"))           return "bbq-day";
  if(types.includes("education"))     return "education-day";
  if(types.includes("committee"))     return "committee-day";
  if(types.includes("admin"))         return "admin-day";
  if(types.includes("closed"))        return "closed-day";
  if(types.includes("clinic"))        return "clinic-day";
  if(types.includes("open"))          return "open-day";
  return "";
}

/* Labels */
function getEventLines(types,date){
  const key = keyFor(date);
  const lines = [];

  /* Christmas/New Years split in the day cell */
  if(types.includes("closure")){
    lines.push("Christmas/New");
    lines.push("Years");
    return lines;
  }
  if(types.includes("easter")){ lines.push("Easter"); return lines; }
  if(types.includes("publicholiday")){ lines.push("Public Holiday"); return lines; }

  if(types.includes("agm")) lines.push("AGM");
  if(types.includes("bbq")) lines.push("BBQ");
  if(types.includes("education")) lines.push(`Education: ${EDUCATION_2026[key]}`);

  /* Committee abbreviated */
  if(types.includes("committee")) lines.push("Comm.");

  /* Open/Clinic split across lines */
  if(types.includes("clinic")){
    lines.push("Open");
    lines.push("Clinic");
  } else if(types.includes("open")){
    lines.push("Open");
  }

  if(types.includes("admin")) lines.push("Closed (Admin Day)");
  if(types.includes("closed")) lines.push("Closed");

  return lines;
}

/* ============================================================================
   Focus Highlight Helpers (arrow-nav only)
============================================================================ */
function clearFocus(){ focusType=null; focusMonthKey=null; }
function setFocus(type,dateForMonth){ focusType=type; focusMonthKey=monthKey(dateForMonth); }

/* ============================================================================
   Single-filter mode UI functions
============================================================================ */
function applySingleFilterUI(){
  const group = document.getElementById("filterGroup");
  const allSingles = group.querySelectorAll("[data-single]");

  allSingles.forEach(el => el.classList.remove("single-hide"));

  if(!singleFilterMode) return;

  allSingles.forEach(el=>{
    if(el.getAttribute("data-single") !== singleFilterMode){
      el.classList.add("single-hide");
    }
  });
}
function setSingleFilterMode(type){ singleFilterMode = type; applySingleFilterUI(); }
function clearSingleFilterMode(){ singleFilterMode = null; applySingleFilterUI(); }

/* ============================================================================
   Rendering
============================================================================ */
function renderCalendar(){
  const y=currentDate.getFullYear(), m=currentDate.getMonth();
  document.getElementById("monthYear").textContent=currentDate.toLocaleDateString("en-US",{month:"long",year:"numeric"});

  const todayNow = new Date(); todayNow.setHours(0,0,0,0);
  const todayKey = keyFor(todayNow);

  const firstDay=new Date(y,m,1).getDay();
  const daysInMonth=new Date(y,m+1,0).getDate();
  const prevMonthDays=new Date(y,m,0).getDate();

  const cal=document.getElementById("calendar");
  cal.innerHTML="";

  dayHeaders.forEach(h=>{
    const e=document.createElement("div");
    e.className="day-header";
    e.textContent=h;
    cal.appendChild(e);
  });

  const anyFilterActive = Object.values(filters).some(v=>v);

  const focusActive =
    Boolean(focusType) &&
    (focusMonthKey === monthKey(currentDate));

  function buildDay(date,offset=0){
    const types = getEventTypes(date);
    const cls = ["day"];

    const bg = pickClass(types);
    if(bg) cls.push(bg);

    if(offset!==0) cls.push("other-month");

    const isToday = (keyFor(date) === todayKey);
    if(isToday) cls.push("today");

    let visible = true;
    if(anyFilterActive && offset===0){
      const matches = Object.entries(filters).some(([t,on])=>on && types.includes(t));
      if(!matches && !isToday) visible = false;
    }
    if(!visible) cls.push("hidden");

    if(focusActive && offset===0){
      const isMatch = types.includes(focusType);
      if(!isMatch) cls.push("dim");
      else cls.push("focus");
    }

    const lines = getEventLines(types,date);
    const d=document.createElement("div");
    d.className=cls.join(" ");
    d.innerHTML =
      `<div class="day-number">${date.getDate()}</div>` +
      (lines.length ? `<div class="day-events">${lines.map(l=>`<div>${l}</div>`).join("")}</div>` : "");
    return d;
  }

  for(let i=0;i<firstDay;i++){
    cal.appendChild(buildDay(new Date(y,m-1,prevMonthDays-firstDay+i+1),-1));
  }
  for(let i=1;i<=daysInMonth;i++){
    cal.appendChild(buildDay(new Date(y,m,i),0));
  }
  const cellsSoFar = cal.children.length - 7;
  const toFill = 42 - cellsSoFar;
  for(let i=1;i<=toFill;i++){
    cal.appendChild(buildDay(new Date(y,m+1,i),1));
  }
}

/* ============================================================================
   Smart Month Scan
============================================================================ */
function findNextMonth(predicate,maxMonths=12){
  for(let off=1; off<=maxMonths; off++){
    const test=new Date(currentDate);
    test.setMonth(currentDate.getMonth()+off);
    const days=new Date(test.getFullYear(),test.getMonth()+1,0).getDate();
    for(let d=1; d<=days; d++){
      const dt=new Date(test.getFullYear(),test.getMonth(),d);
      if(predicate(dt)) return test;
    }
  }
  return null;
}
function findPrevMonth(predicate,maxMonths=12){
  for(let off=1; off<=maxMonths; off++){
    const test=new Date(currentDate);
    test.setMonth(currentDate.getMonth()-off);
    const days=new Date(test.getFullYear(),test.getMonth()+1,0).getDate();
    for(let d=1; d<=days; d++){
      const dt=new Date(test.getFullYear(),test.getMonth(),d);
      if(predicate(dt)) return test;
    }
  }
  return null;
}

/* Arrow-nav jump helper (with focus) */
function navTo(type,direction,predicate){
  const target = direction==="next" ? findNextMonth(predicate,12) : findPrevMonth(predicate,12);
  if(target){
    currentDate = target;
    setFocus(type,target);
    renderCalendar();
  }
}

/* ============================================================================
   Controls
============================================================================ */
document.getElementById("prevMonth").onclick=()=>{
  currentDate.setMonth(currentDate.getMonth()-1);
  clearFocus();
  renderCalendar();
};
document.getElementById("nextMonth").onclick=()=>{
  currentDate.setMonth(currentDate.getMonth()+1);
  clearFocus();
  renderCalendar();
};

document.getElementById("todayBtn").onclick=()=>{
  currentDate = new Date();

  for(const f in filters) filters[f]=false;
  document.querySelectorAll(".filter-btn").forEach(b=>b.classList.remove("active"));

  clearFocus();
  clearSingleFilterMode();

  /* Back to Today restores all filters (exits single-filter mode). */
  renderCalendar();
};

/* Hide/Show Filters single toggle */
const toggleFiltersBtn = document.getElementById("toggleFiltersBtn");
function syncToggleFiltersText(){
  const collapsed = document.body.classList.contains("filters-collapsed");
  toggleFiltersBtn.textContent = collapsed ? "Show Filters" : "Hide Filters";
}
toggleFiltersBtn.onclick = () => {
  document.body.classList.toggle("filters-collapsed");
  syncToggleFiltersText();
};

/* Filter buttons: enter single-filter mode + preserve toggle behavior */
document.querySelectorAll(".filter-btn").forEach(btn=>{
  const f=btn.dataset.filter; if(!f) return;

  btn.addEventListener("click",()=>{
    setSingleFilterMode(f);

    filters[f]=!filters[f];
    btn.classList.toggle("active");

    clearFocus();
    renderCalendar();
  });
});

/* Arrow buttons: force single-filter mode + nav/focus */
document.getElementById("nextBBQ").onclick=()=>{ setSingleFilterMode("bbq"); navTo("bbq","next",d=>inBBQ(d)); };
document.getElementById("prevBBQ").onclick=()=>{ setSingleFilterMode("bbq"); navTo("bbq","prev",d=>inBBQ(d)); };

document.getElementById("nextCommittee").onclick=()=>{ setSingleFilterMode("committee"); navTo("committee","next",d=>isCommitteeDay(d)); };
document.getElementById("prevCommittee").onclick=()=>{ setSingleFilterMode("committee"); navTo("committee","prev",d=>isCommitteeDay(d)); };

document.getElementById("nextPublicHoliday").onclick=()=>{ setSingleFilterMode("publicholiday"); navTo("publicholiday","next",d=>isPublicHoliday(d)); };
document.getElementById("prevPublicHoliday").onclick=()=>{ setSingleFilterMode("publicholiday"); navTo("publicholiday","prev",d=>isPublicHoliday(d)); };

document.getElementById("nextEducation").onclick=()=>{ setSingleFilterMode("education"); navTo("education","next",d=>isEducationDay(d)); };
document.getElementById("prevEducation").onclick=()=>{ setSingleFilterMode("education"); navTo("education","prev",d=>isEducationDay(d)); };

document.getElementById("nextAGM").onclick=()=>{ setSingleFilterMode("agm"); navTo("agm","next",d=>dateEquals(d,AGM_DATE)); };
document.getElementById("prevAGM").onclick=()=>{ setSingleFilterMode("agm"); navTo("agm","prev",d=>dateEquals(d,AGM_DATE)); };

document.getElementById("nextEaster").onclick=()=>{ setSingleFilterMode("easter"); navTo("easter","next",d=>isEaster(d)); };
document.getElementById("prevEaster").onclick=()=>{ setSingleFilterMode("easter"); navTo("easter","prev",d=>isEaster(d)); };

document.getElementById("nextClosure").onclick=()=>{ setSingleFilterMode("closure"); navTo("closure","next",d=>isChristmasClosure(d)); };
document.getElementById("prevClosure").onclick=()=>{ setSingleFilterMode("closure"); navTo("closure","prev",d=>isChristmasClosure(d)); };

/* Initial */
syncToggleFiltersText();
applySingleFilterUI();
renderCalendar();
</script>
</body>
</html>

